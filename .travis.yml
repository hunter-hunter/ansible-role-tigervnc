---
#
# Ansible managed
#
language: python

os: linux
dist: xenial

python:
  - "3.8"

services:
  - docker

env:
  global:
    namespace="robertdebock"
  jobs:
    - image="centos" tag="7"
    - image="debian" tag="latest"
    - image="debian" tag="bullseye"
    - image="fedora" tag="31"
    - image="fedora" tag="latest"

cache:
  - pip

install:
  - pip install --upgrade pip
  - pip install tox

script:
  - function retry { counter=0 ; until "$@" ; do exit=$? ; counter=$(($counter + 1)) ; if [ $counter -ge 3 ] ; then return $exit ; fi ; done ; return 0; } ; retry tox --parallel all

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
  slack:
    secure: "bl8vIjfEonSYnIx6MIs6SUGPlohFVaaj3dbP/kuV9/fJEHio84l6gbMGXJ57/pnhsH/vozDe80sR1/MmTrUpDg04DIVunEKqwxKzWDBPD3dTdLRMrPZvHtvOIq2oA4aP9vT/ARoQ+nNsIag+pdLqNBNzqE9yu7bMNH5uJzQ/cS6ZXLpomr54r9QNTYSIBbJpTvx6+3HEqKiWxmKa3qlGANok3KS1OEpdJYOA/qFkBX+4k0QTZiNhuAM7MpJRf1QqAz+57P3omNLeBlu5IyJtdV+wte8oTveGSKdVzEJ2V3ZP6n5qohu9wVp5qTGdHFKCEOXkCeqQvTXIVcJ8VDtDHsHq7aBB6fqccw/orpgc0waSMJ6fsc8rAAw+4zUtGPaR+QZU2R7d/QxiH3yk0OABv7BF9kd83prxKp21GM9yWjwLGl8vjgo5Nq66vt/VZuY4wIcCruOveuXyT4fgPJDDsGcHm1g5GpwWv4IAfSar+bDLiizRm2xNHjwWrsVrz/SXGX7t0kftiNeaplnft7TcmVxZILa221wOJAwJXs0EjuBaRSwz4A0faT3NgIxYRc32lgxufhqZVC3O9Y0czwZCaHjYYx3wHYH3z/yzws9M70ZCMeCW13sJ28aZnDI0l1def+ylXVIBI/FEQ+F2q/IV+4QiN1FUBTFSm7PyW2e0fKY="
    on_success: change
    template: "%{result}: %{repository_slug}@%{branch}, build <%{build_url}|#%{build_number}> (<%{compare_url}|%{commit}>)"
  email: false
